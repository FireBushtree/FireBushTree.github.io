# 浏览器缓存

使用浏览器缓存可以缩短网页请求资源的距离， 减少延迟， 且缓存文件可以重复利用， 减少带宽， 降低网络
负荷。

**浏览器是否使用缓存，缓存多久，是由服务器控制的。** 当浏览器请求一个网页（或者其他资源时）服务器
发回的响应头部分字段指明了有关缓存的关键信息

## 缓存机制

### 强缓存

如果强缓存命中， 浏览器直接从自己的缓存中读取资源， 不会发送请求到服务器。

当资源命中了强缓存， 最直观的表现在chrome中， 显示状态码为200， 且size显示为`from cache`

通过`Expires和Cache-Control`可以控制强缓存。

#### Expires （http1.0提出）

Expires的描述了一个绝对时间， 由服务器返回， GMT格式的字符串表示。

`Expires: Sat, 01 Dec 2029 02:42:55 GMT`

例如以上资源就表示 在2020年10月1日之前这个资源都是直接从本地加载， 无需请求服务器

但是由于在对比时间的时候， 是由服务器返回的时间与客户端的时间相比较， 所以可能会导致误差， 比如
客户端随便修改了时间， 就会影响缓存命中的结果了。

#### Cache-Control (http 1.1提出)

Cache-Control描述的是一个相对时间， 最直观的表现就是`max-age=2592000`单位是`s`， 表示
在2592000秒（30天）内都会使用这个版本的资源

常见参数
* public    允许客户端以及所有代理服务器缓存
* private   只允许客户端缓存， Cache-Control的默认值
* no-cache  是否使用缓存需要经过协商缓存来验证决定
* no-store  不适用任何缓存， 即不适用强缓存, 也不使用协商缓存
* max-age=X 缓存内容将在X秒后失效

#### 对比

当这两个header同时启用的时候， `Cache-Control`的优先级会高于`Expires`

### 协商缓存

当强缓存未命中， 浏览器一定会发送一个请求到服务器， 服务器会根据这个请求的http header判断是否
命中协商缓存， 如果命中协商缓存， 则会将这个请求返回， 但并不是返回这个资源的数据， 告诉浏览器可以从缓存中加载这个资源。


